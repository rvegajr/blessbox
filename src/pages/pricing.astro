---
// üéä PRICING PAGE - THE MOST BEAUTIFUL PRICING PAGE EVER! ‚ú®
// Where dreams become subscriptions! üíé

import BaseLayout from '../layouts/BaseLayout.astro';
import Text from '../components/fundations/elements/Text.astro';
import Button from '../components/fundations/elements/Button.astro';
import Wrapper from '../components/fundations/containers/Wrapper.astro';
import { PricingService } from '../implementations/pricing/PricingService';

// üéØ Get pricing data with PURE JOY!
const pricingService = new PricingService();
const plans = await pricingService.getPricingPlans();
const comparison = await pricingService.getFeatureComparison();
const promotion = await pricingService.getCurrentPromotion();

// üéä Calculate annual pricing for each plan
const annualPricing = {
  standard: pricingService.getAnnualPricing(plans[1].price),
  enterprise: pricingService.getAnnualPricing(plans[2].price)
};
---

<BaseLayout 
  title="Pricing - BlessBox | Choose Your Perfect Plan" 
  description="Simple, transparent pricing for event registration and QR check-in. Start free, upgrade anytime!"
>
  <Wrapper class="py-16">
    <!-- üéä Hero Section with PURE EXCITEMENT! -->
    <div class="text-center mb-12">
      <Text tag="h1" variant="displayXL" class="font-bold mb-4">
        Choose Your Perfect Plan üéâ
      </Text>
      <Text tag="p" variant="textXL" class="text-base-600 mb-8">
        Start free, upgrade anytime. No credit card required for free plan!
      </Text>
      
      {promotion && (
        <div class="bg-gradient-to-r from-teal-500 to-blue-500 text-white rounded-xl p-4 inline-block mb-8 animate-pulse">
          <Text tag="p" variant="textLG" class="font-bold">
            {promotion.message}
          </Text>
        </div>
      )}

      <!-- üí∞ Billing Toggle with AMAZING SAVINGS! -->
      <div class="flex items-center justify-center gap-4 mb-8">
        <Text tag="span" variant="textBase" class="text-base-600">Monthly</Text>
        <label class="relative inline-flex items-center cursor-pointer">
          <input type="checkbox" id="billingToggle" class="sr-only peer" />
          <div class="w-14 h-7 bg-base-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-teal-500"></div>
        </label>
        <Text tag="span" variant="textBase" class="text-base-600">
          Annual <span class="text-teal-500 font-bold">(Save 17%!)</span>
        </Text>
      </div>
    </div>

    <!-- üéØ Pricing Cards with BEAUTIFUL DESIGN! -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
      {plans.map((plan, index) => (
        <div class={`relative bg-white rounded-2xl shadow-xl overflow-hidden transform hover:scale-105 transition-all duration-300 ${plan.isPopular ? 'ring-4 ring-teal-500' : ''}`}>
          {plan.badge && (
            <div class="absolute top-0 right-0 bg-gradient-to-r from-teal-500 to-blue-500 text-white px-4 py-1 rounded-bl-xl">
              <Text tag="span" variant="textSM" class="font-bold">{plan.badge}</Text>
            </div>
          )}
          
          <div class="p-8">
            <Text tag="h2" variant="textXL" class="font-bold mb-2">{plan.name}</Text>
            
            <div class="mb-6">
              <Text tag="div" variant="displayMD" class="font-bold">
                <span class="monthly-price">
                  ${plan.price === 0 ? '0' : (plan.price / 100).toFixed(2)}
                </span>
                <span class="annual-price hidden">
                  ${plan.price === 0 ? '0' : 
                    index === 1 ? (annualPricing.standard.annualPrice / 100 / 12).toFixed(2) :
                    index === 2 ? (annualPricing.enterprise.annualPrice / 100 / 12).toFixed(2) :
                    '0'}
                </span>
                <Text tag="span" variant="textBase" class="text-base-500">/month</Text>
              </Text>
              {plan.price > 0 && (
                <Text tag="p" variant="textSM" class="text-base-500 annual-savings hidden">
                  Billed annually (Save ${
                    index === 1 ? (annualPricing.standard.monthlySavings / 100).toFixed(2) :
                    index === 2 ? (annualPricing.enterprise.monthlySavings / 100).toFixed(2) :
                    '0'
                  }/year!)
                </Text>
              )}
            </div>

            <ul class="space-y-3 mb-8">
              {plan.features.map(feature => (
                <li class="flex items-start">
                  <Text tag="span" variant="textBase">{feature}</Text>
                </li>
              ))}
            </ul>

            <Button 
              variant={plan.isPopular ? "primary" : "secondary"}
              size="large"
              class="w-full"
              data-plan={plan.id}
              onclick={`handlePlanSelection('${plan.id}')`}
            >
              {plan.price === 0 ? 'Start Free' : 'Get Started'}
            </Button>
          </div>
        </div>
      ))}
    </div>

    <!-- üìä Feature Comparison Table with CLARITY! -->
    <div class="bg-white rounded-2xl shadow-xl p-8 mb-16">
      <Text tag="h2" variant="textXL" class="font-bold text-center mb-8">
        Detailed Feature Comparison üìä
      </Text>
      
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b-2 border-base-200">
              <th class="text-left py-4 px-4">
                <Text tag="span" variant="textBase" class="font-semibold">Feature</Text>
              </th>
              <th class="text-center py-4 px-4">
                <Text tag="span" variant="textBase" class="font-semibold">Free</Text>
              </th>
              <th class="text-center py-4 px-4">
                <Text tag="span" variant="textBase" class="font-semibold">Standard</Text>
              </th>
              <th class="text-center py-4 px-4">
                <Text tag="span" variant="textBase" class="font-semibold">Enterprise</Text>
              </th>
            </tr>
          </thead>
          <tbody>
            {comparison.map((item, index) => (
              <tr class={`border-b border-base-100 ${index % 2 === 0 ? 'bg-base-50' : ''}`}>
                <td class="py-4 px-4">
                  <Text tag="span" variant="textBase" class="font-medium">{item.feature}</Text>
                  {item.description && (
                    <Text tag="p" variant="textSM" class="text-base-500">{item.description}</Text>
                  )}
                </td>
                <td class="text-center py-4 px-4">
                  {typeof item.free === 'boolean' ? (
                    item.free ? '‚úÖ' : '‚ùå'
                  ) : (
                    <Text tag="span" variant="textBase">{item.free}</Text>
                  )}
                </td>
                <td class="text-center py-4 px-4">
                  {typeof item.standard === 'boolean' ? (
                    item.standard ? '‚úÖ' : '‚ùå'
                  ) : (
                    <Text tag="span" variant="textBase">{item.standard}</Text>
                  )}
                </td>
                <td class="text-center py-4 px-4">
                  {typeof item.enterprise === 'boolean' ? (
                    item.enterprise ? '‚úÖ' : '‚ùå'
                  ) : (
                    <Text tag="span" variant="textBase">{item.enterprise}</Text>
                  )}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>

    <!-- üåü Testimonials Section with SOCIAL PROOF! -->
    <div class="mb-16">
      <Text tag="h2" variant="textXL" class="font-bold text-center mb-8">
        Loved by Event Organizers Worldwide üåü
      </Text>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="bg-white rounded-xl shadow-lg p-6">
          <div class="flex mb-4">
            {[1,2,3,4,5].map(() => (
              <span class="text-yellow-400 text-xl">‚≠ê</span>
            ))}
          </div>
          <Text tag="p" variant="textBase" class="mb-4 italic">
            "BlessBox transformed our church events! The QR check-in system is incredibly smooth, 
            and our volunteers love how easy it is to use. Worth every penny!"
          </Text>
          <Text tag="p" variant="textSM" class="font-semibold">Sarah Johnson</Text>
          <Text tag="p" variant="textSM" class="text-base-500">Event Coordinator, Grace Church</Text>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6">
          <div class="flex mb-4">
            {[1,2,3,4,5].map(() => (
              <span class="text-yellow-400 text-xl">‚≠ê</span>
            ))}
          </div>
          <Text tag="p" variant="textBase" class="mb-4 italic">
            "We've tried many registration systems, but BlessBox is by far the best. 
            The custom fields feature lets us collect exactly what we need. Fantastic!"
          </Text>
          <Text tag="p" variant="textSM" class="font-semibold">Mike Chen</Text>
          <Text tag="p" variant="textSM" class="text-base-500">Operations Manager, TechConf 2024</Text>
        </div>
      </div>
    </div>

    <!-- üîí Trust Badges with CONFIDENCE! -->
    <div class="text-center mb-16">
      <div class="flex flex-wrap justify-center gap-8 mb-8">
        <div class="flex items-center gap-2">
          <span class="text-2xl">üîí</span>
          <Text tag="span" variant="textBase" class="font-semibold">SSL Secured</Text>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-2xl">üí≥</span>
          <Text tag="span" variant="textBase" class="font-semibold">PCI Compliant</Text>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-2xl">üõ°Ô∏è</span>
          <Text tag="span" variant="textBase" class="font-semibold">GDPR Compliant</Text>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-2xl">üèÜ</span>
          <Text tag="span" variant="textBase" class="font-semibold">99.9% Uptime</Text>
        </div>
      </div>
      
      <div class="bg-green-50 border-2 border-green-500 rounded-xl p-6 inline-block">
        <Text tag="p" variant="textLG" class="font-bold text-green-700">
          üí∞ 30-Day Money-Back Guarantee
        </Text>
        <Text tag="p" variant="textBase" class="text-green-600">
          Try BlessBox risk-free. Not satisfied? Get a full refund, no questions asked!
        </Text>
      </div>
    </div>

    <!-- üéØ FAQ Section -->
    <div class="max-w-3xl mx-auto">
      <Text tag="h2" variant="textXL" class="font-bold text-center mb-8">
        Frequently Asked Questions ü§î
      </Text>
      
      <div class="space-y-4">
        <details class="bg-white rounded-xl shadow-lg p-6">
          <summary class="font-semibold cursor-pointer">Can I change plans anytime?</summary>
          <Text tag="p" variant="textBase" class="mt-4 text-base-600">
            Absolutely! You can upgrade or downgrade your plan at any time. 
            Changes take effect immediately, and we'll prorate any differences.
          </Text>
        </details>
        
        <details class="bg-white rounded-xl shadow-lg p-6">
          <summary class="font-semibold cursor-pointer">What payment methods do you accept?</summary>
          <Text tag="p" variant="textBase" class="mt-4 text-base-600">
            We accept all major credit cards (Visa, MasterCard, American Express) 
            through our secure Square payment system. We also support ACH for Enterprise plans.
          </Text>
        </details>
        
        <details class="bg-white rounded-xl shadow-lg p-6">
          <summary class="font-semibold cursor-pointer">Is there a setup fee?</summary>
          <Text tag="p" variant="textBase" class="mt-4 text-base-600">
            Never! There are no setup fees, hidden charges, or cancellation fees. 
            Just simple, transparent pricing that grows with your needs.
          </Text>
        </details>
      </div>
    </div>
  </Wrapper>

  <script>
    // üéä Handle billing toggle with SMOOTH ANIMATION!
    const billingToggle = document.getElementById('billingToggle') as HTMLInputElement;
    const monthlyPrices = document.querySelectorAll('.monthly-price');
    const annualPrices = document.querySelectorAll('.annual-price');
    const annualSavings = document.querySelectorAll('.annual-savings');
    
    billingToggle?.addEventListener('change', () => {
      if (billingToggle.checked) {
        // Show annual pricing
        monthlyPrices.forEach(el => el.classList.add('hidden'));
        annualPrices.forEach(el => el.classList.remove('hidden'));
        annualSavings.forEach(el => el.classList.remove('hidden'));
        console.log('üéâ Switched to annual billing - SAVE BIG! üí∞');
      } else {
        // Show monthly pricing
        monthlyPrices.forEach(el => el.classList.remove('hidden'));
        annualPrices.forEach(el => el.classList.add('hidden'));
        annualSavings.forEach(el => el.classList.add('hidden'));
        console.log('üìÖ Switched to monthly billing - flexibility! ‚ú®');
      }
    });
    
    // üéØ Handle plan selection with EXCITEMENT!
    window.handlePlanSelection = function(planId: string) {
      console.log(`üéä Selected ${planId} plan! EXCELLENT CHOICE! üöÄ`);
      
      const isAnnual = (document.getElementById('billingToggle') as HTMLInputElement)?.checked;
      const billing = isAnnual ? 'annual' : 'monthly';
      
      // Redirect to payment page
      window.location.href = `/payment/checkout?plan=${planId}&billing=${billing}`;
    };
  </script>
</BaseLayout>